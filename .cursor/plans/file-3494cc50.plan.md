---
name: Add File Rename Feature to Knowledge Base Upload
overview: ""
todos:
  - id: c51c8be8-1bdd-452f-abbb-fbb6d939b6ca
    content: Create FileRenameDialog widget with validation
    status: pending
  - id: 5fdd566a-12ae-4cd8-8692-3a350da92b9f
    content: Update Knowledge Base screen upload flow
    status: pending
  - id: e7ccf92e-ba2a-4b0a-825d-04be3f31c1d1
    content: Update Game Design Assistant screen upload flow
    status: pending
  - id: 6c352557-3c07-4fed-b5ce-5774c21f9bfe
    content: Test name validation and edge cases
    status: pending
---

# Add File Rename Feature to Knowledge Base Upload

## Overview

Implement a file rename dialog that appears after users select files for upload in both the Knowledge Base screen and Game Design Assistant screen. Users can optionally rename files before they are uploaded to the knowledge base.

## Implementation Steps

### 1. Create Rename Dialog Widget

Create a new reusable widget `FileRenameDialog` that will:

- Accept a list of selected files (with original names and paths)
- Display each file with an editable text field for the name
- Show file extension separately (non-editable) to prevent format issues
- Validate names (no empty names, no duplicate names)
- Return a map of file paths to new names

**New file**: `lib/widgets/file_rename_dialog.dart`

### 2. Update Knowledge Base Screen Upload Flow

Modify [`lib/screens/knowledge_base/knowledge_base_screen.dart`](lib/screens/knowledge_base/knowledge_base_screen.dart):

- After file selection (line 62-66), show the rename dialog
- Pass the selected files to the dialog
- Get the renamed file names from the dialog result
- Use the new names when calling `_chatApiService.uploadFile()` (line 76-80)

### 3. Update Game Design Assistant Screen Upload Flow

Modify [`lib/screens/game_design_assistant/game_design_assistant_screen.dart`](lib/screens/game_design_assistant/game_design_assistant_screen.dart):

- After file selection (line 676-680), show the rename dialog
- Pass the selected files to the dialog
- Get the renamed file names from the dialog result
- Use the new names when calling `_chatApiService.uploadFile()` (line 686-690)

### 4. Keep API Service Unchanged

The `ChatApiService.uploadFile()` method in [`lib/screens/game_design_assistant/services/chat_api_service.dart`](lib/screens/game_design_assistant/services/chat_api_service.dart) already accepts a `fileName` parameter (line 152), so no changes needed there.

## Technical Details

- The rename dialog will be cancellable (user can back out without uploading)
- File extensions will be preserved to maintain file type validation
- Duplicate name validation will prevent conflicts
- Empty name validation will ensure all files have valid names
- The dialog UI will match the existing app theme (dark mode compatible)